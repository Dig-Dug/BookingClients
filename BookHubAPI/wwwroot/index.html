<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
        }

        input, button {
            margin: 0.5rem;
            padding: 0.5rem;
        }

        .book {
            margin: 0.25rem 0;
        }
    </style>
</head>
<body>
    <h1>Book Manager :D </h1>

    <h2>Add a Book</h2>
    <input id="title" placeholder="Title">
    <input id="author" placeholder="Author">
    <input id="year" type="number" placeholder="Year">
    <button onclick="addBook()">Add</button>

    <h2>Edit Book</h2>
    <form id="editBookForm">
        <input type="hidden" id="editId">
        <input type="text" id="editTitle" placeholder="Title" required>
        <input type="text" id="editAuthor" placeholder="Author" required>

        <input type="text" id="editYear" placeholder="Year">

        <button type="submit">Update</button>
    </form>

    <h2>Filter Books</h2>

    <input id="titleFilter" placeholder="Title">
    <input id="authorFilter" placeholder="Author">
    <input id="yearFilter" type="number" placeholder="Year">
    <button onclick="loadBooks()">Filter</button>

    <table id="booksTable" border="1" cellpadding="5">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Year</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Books will be loaded here -->
        </tbody>
    </table>

    <h2>All Books</h2>
    <table id="booksTable" border="1" cellpadding="5">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>


    <!--   <script>
           const API_URL = "http://localhost:5288/books"; // adjust port if needed

           function loadBooks() {
               fetch("http://localhost:5288/books")
                   .then(response => response.json())
                   .then(data => {
                       const tbody = document.querySelector("#booksTable tbody");
                       tbody.innerHTML = "";

                       data.forEach(book => {
                           const row = document.createElement("tr");

                           row.innerHTML = `
                               <td>${book.id}</td>
                               <td>${book.title}</td>
                               <td>${book.author}</td>
                               <td>
                                   <button onclick="editBook(${book.id}, '${book.title}', '${book.author}')">Edit</button>
                                   <button onclick="deleteBook(${book.id})">Delete</button>
                               </td>
                           `;

                           tbody.appendChild(row);
                       });
                   });
           }


           async function addBook() {
               const title = document.getElementById("title").value;
               const author = document.getElementById("author").value;

               await fetch(API_URL, {
                   method: "POST",
                   headers: { "Content-Type": "application/json" },
                   body: JSON.stringify({ title, author })
               });


               document.getElementById("title").value = "";
               document.getElementById("author").value = "";
               loadBooks();
           }

           /*     function loadBooks() {
                    fetch("http://localhost:5288/books")
                        .then(response => response.json())
                        .then(data => {
                            const tbody = document.querySelector("#booksTable tbody");
                            tbody.innerHTML = "";

                            data.forEach(book => {
                                const row = document.createElement("tr");

                                row.innerHTML = `
                                <td>${book.id}</td>
                                <td>${book.title}</td>
                                <td>${book.author}</td>
                                <td>
                                    <button onclick="editBook(${book.id}, '${book.title}', '${book.author}')">Edit</button>
                                    <button onclick="deleteBook(${book.id})">Delete</button>
                                </td>
                            `;

                                tbody.appendChild(row);
                            });
                        });
                }*/


           function loadBooks() {
               const title = document.getElementById("titleFilter").value;
               const author = document.getElementById("authorFilter").value;
               const year = document.getElementById("yearFilter").value;


               const query = new URLSearchParams();
               if (title) query.append("title", title);
               if (author) query.append("author", author);
               if (year) query.append("year", year);

               fetch(`${API_URL}?${query.toString()}`)
                   .then(res => res.json())
                   .then(data => {
                       const tbody = document.querySelector("#booksTable tbody");
                       tbody.innerHTML = "";
                       data.forEach(book => {
                           const row = document.createElement("tr");
                           row.innerHTML = `
                           <td>${book.id}</td>
                           <td>${book.title}</td>
                           <td>${book.author}</td>
                           <td>${book.year}</td>
                           <td>
                               <button onclick="editBook(${book.id}, '${book.title}', '${book.author}', ${book.year})">Edit</button>
                               <button onclick="deleteBook(${book.id})">Delete</button>
                           </td>
                       `;
                           tbody.appendChild(row);
                       });
                   });
           }


           function editBook(id, title, author) {
               document.getElementById("editId").value = id;
               document.getElementById("editTitle").value = title;
               document.getElementById("editAuthor").value = author;
           }

           document.getElementById("editBookForm").addEventListener("submit", function (e) {
               e.preventDefault();

               const id = document.getElementById("editId").value;
               const title = document.getElementById("editTitle").value;
               const author = document.getElementById("editAuthor").value;

               fetch(`http://localhost:5288/books/${id}`, {
                   method: "PUT",
                   headers: { "Content-Type": "application/json" },
                   body: JSON.stringify({ title, author })
               })
                   .then(response => {
                       if (response.ok) {
                           loadBooks();
                           document.getElementById("editBookForm").reset();
                       } else {
                           alert("Update failed");
                       }
                   });
           });

           async function deleteBook(id) {
               if (!confirm("Are you sure you want to delete this book?")) return;

               const response = await fetch(`${API_URL}/${id}`, {
                   method: "DELETE"
               });

               if (response.ok) {
                   loadBooks(); // refresh the table
               } else {
                   alert("Failed to delete the book");
               }
           }


       </script> -->

    <script>
        const API_URL = "http://localhost:5288/books"; // adjust port if needed

        async function addBook() {
            const title = document.getElementById("title").value.trim();
            const author = document.getElementById("author").value.trim();
            const yearValue = document.getElementById("year").value;
            const year = yearValue ? parseInt(yearValue) : null;

            if (!title || !author) {
                alert("Title and Author cannot be empty.");
                return;
            }

            await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, author, year })
            });

            document.getElementById("title").value = "";
            document.getElementById("author").value = "";
            document.getElementById("year").value = "";
            loadBooks();
        }

      

        function editBook(id, title, author, year) {
            document.getElementById("editId").value = id;
            document.getElementById("editTitle").value = title;
            document.getElementById("editAuthor").value = author;
            document.getElementById("editYear").value = year ?? ""
        }

        document.getElementById("editBookForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const id = document.getElementById("editId").value;
            const title = document.getElementById("editTitle").value.trim();
            const author = document.getElementById("editAuthor").value.trim();
            const year = parseInt(document.getElementById("editYear").value) || null;

            if (!title || !author) {
                alert("Title and Author cannot be empty.");
                return;
            }

            const res = await fetch(`${API_URL}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, author, year })
            });

            if (res.ok) {
                loadBooks();
                document.getElementById("editBookForm").reset();
            } else {
                alert("Update failed");
            }
        });


        async function deleteBook(id) {
            if (!confirm("Are you sure you want to delete this book?")) return;

            const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
            if (res.ok) loadBooks();
            else alert("Failed to delete the book");
        }

        // Initial load
        loadBooks();
    </script>

</body>
</html>
